package net.justminecraft.net.minigames.capturetheflag;

import net.justminecraft.minigames.minigamecore.ActionBar;
import net.justminecraft.minigames.minigamecore.Game;
import net.justminecraft.minigames.minigamecore.MG;
import org.bukkit.ChatColor;
import org.bukkit.entity.Player;

public class PlayerRespawnInvulnerability implements Runnable {
    private final Player player;

    public PlayerRespawnInvulnerability(Player player) {
        this.player = player;
        run();
    }

    @Override
    public void run() {
        Game g = MG.core().getGame(player);
        if(g == null || g.minigame != CaptureTheFlag.getPlugin()) return;
        CaptureTheFlagGame game = (CaptureTheFlagGame) g;
        if(!game.respawnInvulnerability.containsKey(player)) return;
        int aliveTime = game.respawnInvulnerability.get(player);
        if(aliveTime <= 0) {
            game.respawnInvulnerability.remove(player);
            ActionBar actionBar = new ActionBar(ChatColor.GREEN + "Your Invulnerability Expired!");
            actionBar.send(player);
            return;
        }
        game.respawnInvulnerability.replace(player, aliveTime - 1);
        CaptureTheFlag.getPlugin().getServer().getScheduler().runTaskLater(CaptureTheFlag.getPlugin(), this, 20);
    }
}
